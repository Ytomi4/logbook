# Requirements Document

## Introduction

タイムラインページの UI を再設計し、ユーザープロフィールを中心とした視覚的に統一感のあるレイアウトへ変更する。また、自分のタイムラインでは常にログ入力フォームを表示し、素早くログを記録できるようにする。

この変更により、タイムラインページが「このユーザーの読書記録」という文脈を明確に伝え、自分のページでは思考を中断せずにログを追加できる体験を提供する。

## Alignment with Product Vision

この機能は product.md に記載された以下の原則と合致する：

- **シンプルさ優先**: ログ追加・本追加ボタンを削除し、UI を簡潔にする
- **高速な操作**: 常時表示されるログ入力フォームにより、モーダルを開く手間なしに即座に記録可能
- **読書中に使える**: ワンステップでログを追加できるため、読書の流れを中断しない
- **公開プロフィール**: ユーザー情報を中央に大きく表示し、「誰のタイムラインか」を明確に示す

## Requirements

### REQ-1: ユーザープロフィールの中央配置

**User Story:** ユーザーとして、タイムラインページを開いたときに誰の読書記録かが一目でわかるように、ユーザーアイコンとハンドルネームをページの中央に大きく表示してほしい。

#### Acceptance Criteria

1. WHEN ユーザーがタイムラインページ（`/u/:username`）を開く THEN システムはユーザーアイコンをページ中央に表示する SHALL。アイコンは現在の `w-8 h-8`（32px）より大きく、視覚的に目立つサイズ（例：64px〜80px）とする。
2. WHEN ユーザーアイコンが表示される THEN ハンドルネーム（`@username`）はアイコンの直下に中央揃えで表示される SHALL。
3. IF ユーザーがアバター画像を設定していない THEN システムはユーザー名の頭文字をプレースホルダーとして表示する SHALL。

### REQ-2: タブナビゲーションの中央配置

**User Story:** ユーザーとして、タイムラインと本の一覧の切り替えタブがユーザー情報の直下に配置されることで、視覚的な一貫性を持ってコンテンツを切り替えたい。

#### Acceptance Criteria

1. WHEN タイムラインページが表示される THEN タブナビゲーション（タイムライン / 本の一覧）はユーザープロフィールの直下に中央揃えで配置される SHALL。
2. WHEN タブをクリックする THEN 現在と同様にタブ切り替えが機能する SHALL。

### REQ-3: ヘッダーアクションボタンの削除

**User Story:** ユーザーとして、シンプルなUIを好むため、「ログを追加」「本を追加」ボタンをヘッダーから削除してほしい。

#### Acceptance Criteria

1. WHEN 自分のタイムラインページを表示する THEN 「ログを追加」「本を追加」ボタンはヘッダーに表示されない SHALL。
2. WHEN 他ユーザーのタイムラインページを表示する THEN 元々これらのボタンは表示されていないため変更なし。

### REQ-4: インラインログ入力フォームの表示

**User Story:** ユーザーとして、自分のタイムラインページを開いたときに、ログ入力フォームが常に表示されていることで、モーダルを開く手間なく素早くログを記録したい。

#### Acceptance Criteria

1. WHEN 自分のタイムラインページを表示する AND タイムラインタブがアクティブ THEN ログ入力フォームがタイムラインの上部に常時表示される SHALL。
2. IF 他ユーザーのタイムラインページを表示している THEN ログ入力フォームは表示されない SHALL。
3. WHEN 本の一覧タブがアクティブ THEN ログ入力フォームは表示されない SHALL。

### REQ-5: ログ入力フォームでの本の選択

**User Story:** ユーザーとして、ログを追加する際にどの本に紐づけるかを選択でき、最近読んでいる本がデフォルトで選ばれていることで、効率的にログを記録したい。

#### Acceptance Criteria

1. WHEN ログ入力フォームが表示される THEN ユーザーはログを紐づける本を選択するためのモーダルを開くことができる SHALL。
2. WHEN ログ入力フォームが表示される THEN タイムラインの一番上（最新）に表示されているログに紐づいている本がデフォルトで選択される SHALL。
3. IF タイムラインにログがない THEN ユーザーの本一覧から最初の本がデフォルトで選択される SHALL。
4. IF ユーザーに本が登録されていない THEN ログ入力フォームは「本を登録してください」というメッセージとともに本登録へのリンクを表示する SHALL。

### REQ-6: 本選択UIの改善

**User Story:** ユーザーとして、本の選択ボタンがシンプルで分かりやすく、新しい本の登録への導線もすぐに見つけられるようにしてほしい。

#### Acceptance Criteria

1. WHEN 本の選択ボタンが表示される THEN ドロップダウンを示す下矢印アイコンは表示されない SHALL。
2. WHEN 本の選択ボタンが表示される THEN ボタンの横幅はコンパクトにし、本のタイトルが長い場合は省略表示（truncate）する SHALL。
3. WHEN ログ入力フォームが表示される THEN 本の選択ボタンの右側に「本を追加」リンクが表示される SHALL。
4. WHEN ユーザーが「本を追加」リンクをクリックする THEN 本登録ページ（`/books/new`）に遷移する SHALL。

## Non-Functional Requirements

### Code Architecture and Modularity
- **Single Responsibility Principle**: 新しいログ入力フォームコンポーネントは既存の `QuickLogModal` のロジックを再利用しつつ、インライン表示用に分離する
- **Modular Design**: `UserProfileHeader` のような新コンポーネントを作成し、再利用可能にする
- **Dependency Management**: 既存のフックやサービスを活用し、新しい依存関係を最小限に抑える

### Performance
- ログ入力フォームは遅延なく即座に表示される（追加のAPIリクエストを初期表示時に発生させない）
- 本の選択肢は既にロード済みのデータを利用する

### Usability
- フォームはシンプルで直感的に使える
- キーボードでの入力がスムーズに行える（Tab で本選択 → テキスト入力 → 送信）
- 送信後はフォームがクリアされ、タイムラインが更新される
