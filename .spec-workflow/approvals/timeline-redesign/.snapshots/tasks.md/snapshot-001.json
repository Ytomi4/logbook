{
  "id": "snapshot_1765979837836_j1g4fjxfu",
  "approvalId": "approval_1765979837831_r4lhw9war",
  "approvalTitle": "Timeline Redesign - Tasks Document",
  "version": 1,
  "timestamp": "2025-12-17T13:57:17.836Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document: Timeline Redesign\n\n## Phase 1: 共通コンポーネントとフック\n\n- [ ] 1. BookCover コンポーネントの作成\n  - File: `src/components/common/BookCover.tsx`\n  - 書影サムネイル表示コンポーネント\n  - coverUrl がない場合はデフォルトアイコン表示\n  - サイズバリエーション（sm: 32x48, md: 48x64, lg: 64x96）\n  - Purpose: タイムラインと本一覧で書影を統一的に表示\n  - _Leverage: 既存の Tailwind CSS クラス_\n  - _Requirements: 3.1, 3.2, 3.3_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React/TypeScript Developer specializing in UI components | Task: Create BookCover component at src/components/common/BookCover.tsx. Props: coverUrl (string | null), title (string), size ('sm' | 'md' | 'lg', default 'md'), className (optional). Show image if coverUrl exists, otherwise show a book icon placeholder with gray background. Sizes: sm=32x48px, md=48x64px, lg=64x96px. Use rounded corners (4px). Handle image load errors by showing fallback icon. | Restrictions: Do not add external dependencies, use only Tailwind CSS for styling, do not modify other files | Success: Component renders correctly with/without coverUrl, all sizes work, image errors handled gracefully. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 2. useTabNavigation フックの作成\n  - File: `src/hooks/useTabNavigation.ts`\n  - タブ状態管理（timeline | books）\n  - デフォルトタブの設定\n  - Purpose: HomePage でのタブ切り替え状態管理\n  - _Leverage: React useState_\n  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Developer specializing in custom hooks | Task: Create useTabNavigation hook at src/hooks/useTabNavigation.ts. Define TabType = 'timeline' | 'books'. Return { activeTab, setActiveTab }. Accept optional defaultTab parameter (defaults to 'timeline'). | Restrictions: Keep it simple, no side effects, no localStorage persistence for now | Success: Hook manages tab state correctly, type-safe. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 3. useBookList フックの作成\n  - File: `src/hooks/useBookList.ts`\n  - 本一覧のデータ取得・削除ロジック\n  - BookListPage.tsx のロジックを抽出\n  - Purpose: BookListView での本一覧データ管理\n  - _Leverage: src/services/books.ts (getBooks, deleteBook), src/pages/BookListPage.tsx のロジック_\n  - _Requirements: 4.1, 4.2, 4.3_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Developer specializing in data fetching hooks | Task: Create useBookList hook at src/hooks/useBookList.ts. Extract logic from BookListPage.tsx. Return { books, isLoading, error, deleteBook, refetch }. Use getBooks and deleteBook from services/books.ts. Handle ApiClientError for error messages. Auto-fetch on mount with useEffect. | Restrictions: Do not modify BookListPage.tsx yet, follow existing hook patterns in the codebase | Success: Hook fetches books, handles loading/error states, deleteBook works with refetch. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 4. TabNavigation コンポーネントの作成\n  - File: `src/components/common/TabNavigation.tsx`\n  - タイムライン/本一覧タブ UI\n  - Figma デザインに合わせたスタイル\n  - Purpose: タブ切り替え UI の提供\n  - _Leverage: Figma デザイン（node-id: 11:159-169）_\n  - _Requirements: 1.1, 1.2, 1.3, 1.4_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React/TypeScript Developer specializing in UI components | Task: Create TabNavigation component at src/components/common/TabNavigation.tsx. Props: activeTab ('timeline' | 'books'), onTabChange callback. Style per Figma: container bg-gray-100 rounded-[14px] h-[36px] p-[5px], active tab has white bg with border, inactive has no bg. Include clock icon for Timeline tab, book icon for Books tab. Tab labels: 'タイムライン', '本の一覧'. | Restrictions: Use only Tailwind CSS, inline SVG icons, no external icon libraries | Success: Tabs render correctly, active state is visually distinct, clicking triggers onTabChange. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 5. HeaderActionButtons コンポーネントの作成\n  - File: `src/components/common/HeaderActionButtons.tsx`\n  - 「ログを追加」「本を追加」ボタン\n  - Figma デザインに合わせたスタイル\n  - Purpose: ヘッダーのアクションボタン提供\n  - _Leverage: src/components/common/Button.tsx, react-router-dom Link, Figma デザイン（node-id: 11:145-155）_\n  - _Requirements: 5.1, 5.2, 5.3, 5.4_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Developer | Task: Create HeaderActionButtons at src/components/common/HeaderActionButtons.tsx. Props: onAddLog callback. Two buttons: 1) 'ログを追加' - black bg (bg-gray-900), white text, plus icon, calls onAddLog. 2) '本を追加' - white bg, gray border, book-plus icon, Link to /books/new. Both h-[36px] rounded-[8px]. Use inline SVG icons. | Restrictions: Use existing Button component if suitable or create custom buttons with Tailwind | Success: Both buttons render correctly, ログを追加 triggers callback, 本を追加 navigates to /books/new. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n## Phase 2: タイムラインコンポーネントのリファクタリング\n\n- [ ] 6. TimelineItem コンポーネントの簡素化\n  - File: `src/components/Timeline/TimelineItem.tsx`\n  - カード枠を削除、Figma デザインに合わせて簡素化\n  - ドットスタイルの変更（グレー塗り、引用はボーダーのみ）\n  - 編集機能削除、削除ボタンのみ残す\n  - Purpose: Figma デザインに合わせたログ表示\n  - _Leverage: 既存の TimelineItem.tsx, QuoteDisplay.tsx_\n  - _Requirements: 2.3, 2.4_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Developer specializing in refactoring | Task: Refactor TimelineItem at src/components/Timeline/TimelineItem.tsx. Changes: 1) Remove card wrapper (border, shadow, padding), content is plain text. 2) Dot style: 16px circle, gray-500 fill for memo, border-only (no fill) for quote. 3) Remove edit functionality (isEditMode, handleEdit, onEdit prop). 4) Keep delete button (trash icon) on right side, visible on hover. 5) Show timestamp below content in gray-500. 6) Simplify props: log, isLast, onDelete, isDeleting. | Restrictions: Keep QuoteDisplay usage for quotes, maintain existing delete confirmation UX | Success: Cleaner UI matching Figma, no edit mode, delete still works. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 7. TimelineGroup コンポーネントの改修（書影追加）\n  - File: `src/components/Timeline/TimelineGroup.tsx`\n  - 書影サムネイル追加（BookCover 使用）\n  - 本ヘッダーのドットスタイル変更（黒丸、白い内円）\n  - 縦ラインのスタイル調整\n  - Purpose: 書影付きの本グループ表示\n  - _Leverage: BookCover コンポーネント（Task 1）, 既存の TimelineGroup.tsx_\n  - _Requirements: 2.1, 2.2, 2.5, 3.1, 3.2, 3.4_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Developer | Task: Refactor TimelineGroup at src/components/Timeline/TimelineGroup.tsx. Changes: 1) Add BookCover (size='md') next to book title. 2) Book header dot: 16px black circle (bg-gray-900) with 8px white inner circle. 3) Vertical line: 2px wide, bg-gray-200 (or rgba(0,0,0,0.1)), positioned at left-[7px]. 4) Layout: dot + gap-4 + BookCover + (title + author stack). 5) Keep Link to book detail on both cover and title. | Restrictions: Import BookCover from ../common, maintain existing TimelineItem integration | Success: Book groups show cover image, dot and line styles match Figma. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 8. TimelineView コンポーネントの作成\n  - File: `src/components/Timeline/TimelineView.tsx`\n  - タイムラインタブのコンテンツコンテナ\n  - useTimeline を使用したデータ取得\n  - Purpose: タブ内でのタイムライン表示\n  - _Leverage: src/hooks/useTimeline.ts, src/components/Timeline/Timeline.tsx_\n  - _Requirements: 1.2_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Developer | Task: Create TimelineView at src/components/Timeline/TimelineView.tsx. This is a container component that uses useTimeline hook and renders Timeline component. Handle loading state (show Loading component), error state (show error message with retry), and empty state (delegates to Timeline's TimelineEmpty). No props needed - self-contained. | Restrictions: Reuse existing useTimeline and Timeline components, do not duplicate logic | Success: TimelineView fetches and displays timeline data with proper loading/error handling. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n## Phase 3: 本一覧コンポーネント\n\n- [ ] 9. BookGrid コンポーネントの作成\n  - File: `src/components/BookList/BookGrid.tsx`\n  - 本のグリッド表示（BookListPage から抽出）\n  - 削除機能付き\n  - Purpose: 本一覧のグリッド UI\n  - _Leverage: src/pages/BookListPage.tsx のグリッド部分_\n  - _Requirements: 4.2, 4.3_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Developer | Task: Create BookGrid at src/components/BookList/BookGrid.tsx. Props: books (BookWithLogCount[]), onDelete callback (optional). Extract grid rendering logic from BookListPage.tsx. Use existing Card/CardContent components. Grid: gap-4 sm:grid-cols-2 lg:grid-cols-3. Each card shows title, author, publisher, logCount. Include delete button with confirmation (extract from BookListPage). | Restrictions: Create new directory src/components/BookList/, do not modify BookListPage yet | Success: BookGrid renders book cards with delete functionality. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 10. BookListView コンポーネントの作成\n  - File: `src/components/BookList/BookListView.tsx`\n  - 本一覧タブのコンテンツコンテナ\n  - useBookList を使用したデータ取得\n  - Purpose: タブ内での本一覧表示\n  - _Leverage: useBookList フック（Task 3）, BookGrid（Task 9）_\n  - _Requirements: 4.1, 4.2, 4.3, 4.4_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Developer | Task: Create BookListView at src/components/BookList/BookListView.tsx. Container using useBookList hook. Handle loading (Loading component), error (error message + retry button), empty (message + Link to /books/new). Render BookGrid with books and deleteBook handler. No header needed (handled by HomePage). | Restrictions: Reuse useBookList and BookGrid, keep it simple | Success: BookListView shows book grid with proper loading/error/empty states. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 11. BookList バレルエクスポートの作成\n  - File: `src/components/BookList/index.ts`\n  - BookGrid, BookListView のエクスポート\n  - Purpose: インポートパスの簡略化\n  - _Leverage: 既存の components/*/index.ts パターン_\n  - _Requirements: N/A (infrastructure)_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: TypeScript Developer | Task: Create barrel export at src/components/BookList/index.ts. Export BookGrid and BookListView. Follow existing pattern from src/components/common/index.ts. | Restrictions: Only export public components | Success: Components can be imported from '../components/BookList'. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n## Phase 4: ページ統合\n\n- [ ] 12. HomePage コンポーネントの作成\n  - File: `src/pages/HomePage.tsx`\n  - タブナビゲーション統合ページ\n  - ヘッダー（タイトル、説明、アクションボタン）\n  - タブ切り替えによるビュー表示\n  - QuickLogModal の統合\n  - Purpose: タイムラインと本一覧の統合メインページ\n  - _Leverage: TabNavigation, HeaderActionButtons, TimelineView, BookListView, QuickLogModal, useTabNavigation_\n  - _Requirements: 1.1-1.5, 5.1-5.4_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Developer | Task: Create HomePage at src/pages/HomePage.tsx. Structure: 1) Header with app title '読書ログ' + subtitle '読書の記録を時系列で振り返りましょう' + HeaderActionButtons. 2) TabNavigation below header. 3) Conditional render: TimelineView when activeTab='timeline', BookListView when activeTab='books'. 4) QuickLogModal integration (state: isQuickLogOpen, pass to HeaderActionButtons onAddLog). Use useTabNavigation hook. Match Figma layout with centered content (max-w-3xl mx-auto or similar). | Restrictions: Do not include ShareButton (remove from this page) | Success: Full page with working tab navigation, quick log modal, proper layout. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 13. App.tsx ルーティングの更新\n  - File: `src/App.tsx`\n  - `/` を HomePage に変更\n  - `/books` ルートを削除（またはリダイレクト）\n  - Purpose: 新しいページ構造への移行\n  - _Leverage: 既存の App.tsx_\n  - _Requirements: 1.1_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Developer | Task: Update App.tsx routing. Changes: 1) Import HomePage instead of TimelinePage. 2) Change Route path=\"/\" to render HomePage. 3) Remove or redirect /books route (can add Navigate redirect to / for backward compat). Keep /books/new and /books/:id routes unchanged. | Restrictions: Maintain backward compatibility for /books/:id and /books/new | Success: / renders HomePage, /books redirects or removed, other routes work. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 14. useKeyboardShortcuts の更新\n  - File: `src/hooks/useKeyboardShortcuts.ts`\n  - Alt+H, Alt+B をタブ切り替えに対応\n  - グローバルタブ状態との連携方法を検討\n  - Purpose: キーボードショートカットの整合性維持\n  - _Leverage: 既存の useKeyboardShortcuts.ts_\n  - _Requirements: 1.5_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Developer | Task: Update useKeyboardShortcuts at src/hooks/useKeyboardShortcuts.ts. Current behavior uses navigate() for Alt+H (/) and Alt+B (/books). New behavior: Since both views are now on /, we need a different approach. Option 1: Keep navigation to / for both (simple, but loses tab state). Option 2: Add optional callback props for tab switching. Option 3: Use URL hash (#timeline, #books) or query param. Recommend Option 1 for simplicity - navigate to / which defaults to timeline tab. Alt+B could navigate to /?tab=books if we add query param support to HomePage. Implement the simplest working solution. | Restrictions: Keep Alt+N for /books/new unchanged | Success: Keyboard shortcuts work with new page structure. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n## Phase 5: クリーンアップとエクスポート\n\n- [ ] 15. common/index.ts バレルエクスポートの更新\n  - File: `src/components/common/index.ts`\n  - BookCover, TabNavigation, HeaderActionButtons の追加\n  - Purpose: 新コンポーネントのエクスポート\n  - _Leverage: 既存の index.ts_\n  - _Requirements: N/A (infrastructure)_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: TypeScript Developer | Task: Update src/components/common/index.ts to export new components: BookCover, TabNavigation, HeaderActionButtons. Follow existing export pattern. | Restrictions: Only add exports, do not remove existing ones | Success: New components can be imported from '../components/common'. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 16. Timeline/index.ts バレルエクスポートの更新\n  - File: `src/components/Timeline/index.ts`\n  - TimelineView の追加\n  - Purpose: 新コンポーネントのエクスポート\n  - _Leverage: 既存の index.ts_\n  - _Requirements: N/A (infrastructure)_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: TypeScript Developer | Task: Update src/components/Timeline/index.ts to export TimelineView. Follow existing export pattern. | Restrictions: Only add exports | Success: TimelineView can be imported from '../components/Timeline'. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 17. 不要ファイルの削除検討\n  - Files: `src/pages/TimelinePage.tsx`, `src/pages/BookListPage.tsx`\n  - TimelinePage は HomePage に置き換え\n  - BookListPage のロジックは hooks/components に移動済み\n  - Purpose: コードベースの整理\n  - _Leverage: 新しい HomePage, useBookList, BookListView_\n  - _Requirements: N/A (cleanup)_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Senior Developer | Task: Review and clean up deprecated files. 1) TimelinePage.tsx - can be deleted if HomePage fully replaces it. 2) BookListPage.tsx - can be deleted if useBookList and BookListView cover all functionality. Before deleting: verify no other imports reference these files (grep for imports). If still referenced, update those references first. | Restrictions: Only delete if safe, verify no breaking imports | Success: Unused files removed, no broken imports. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n## Phase 6: テスト\n\n- [ ] 18. コンポーネントテストの作成\n  - Files: `tests/components/BookCover.test.tsx`, `tests/components/TabNavigation.test.tsx`\n  - 新規コンポーネントのユニットテスト\n  - Purpose: コンポーネントの信頼性確保\n  - _Leverage: 既存のテストパターン, Vitest, Testing Library_\n  - _Requirements: All (testing)_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer specializing in React testing | Task: Create unit tests for new components. 1) BookCover.test.tsx: test with/without coverUrl, different sizes, image error fallback. 2) TabNavigation.test.tsx: test tab rendering, click handlers, active state styling. Use @testing-library/react and vitest. Follow existing test patterns in the codebase. | Restrictions: Mock external dependencies, test in isolation | Success: Tests pass, good coverage of component behavior. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 19. フックテストの作成\n  - Files: `tests/hooks/useTabNavigation.test.ts`, `tests/hooks/useBookList.test.ts`\n  - 新規フックのユニットテスト\n  - Purpose: フックの信頼性確保\n  - _Leverage: @testing-library/react-hooks または renderHook_\n  - _Requirements: All (testing)_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer | Task: Create unit tests for new hooks. 1) useTabNavigation.test.ts: test default tab, tab switching. 2) useBookList.test.ts: test initial fetch, loading state, error handling, deleteBook, refetch. Mock API calls. Use renderHook from @testing-library/react. | Restrictions: Mock all API calls, test hook logic in isolation | Success: Tests pass, hooks work correctly in all scenarios. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n\n- [ ] 20. E2E テスト（タブナビゲーション）\n  - File: `tests/e2e/tabNavigation.test.ts` (if E2E setup exists)\n  - タブ切り替えのユーザーフロー\n  - Purpose: ユーザー体験の検証\n  - _Leverage: 既存の E2E テストセットアップ（あれば）_\n  - _Requirements: 1.1-1.5_\n  - _Prompt: Implement the task for spec timeline-redesign, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Automation Engineer | Task: If E2E testing is set up (Playwright/Cypress), create tab navigation tests. Test: 1) Default tab is timeline. 2) Click 'books' tab shows book list. 3) Click 'timeline' tab returns to timeline. 4) Quick log modal opens from header button. If no E2E setup, skip this task and note it as future work. | Restrictions: Only implement if E2E framework is already configured | Success: E2E tests pass or task documented as skipped. After implementation, mark task as in-progress in tasks.md before starting, use log-implementation tool to record implementation details, then mark task as complete [x] in tasks.md._\n",
  "fileStats": {
    "size": 24303,
    "lines": 193,
    "lastModified": "2025-12-17T13:57:10.106Z"
  },
  "comments": []
}