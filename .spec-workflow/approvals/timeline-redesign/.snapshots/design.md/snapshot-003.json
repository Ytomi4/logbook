{
  "id": "snapshot_1766210758650_7jsto17p2",
  "approvalId": "approval_1765986280917_2wgm0ciiu",
  "approvalTitle": "Timeline Redesign - Design (UserInfo コンポーネント追加)",
  "version": 3,
  "timestamp": "2025-12-20T06:05:58.650Z",
  "trigger": "revision_requested",
  "status": "pending",
  "content": "# Design Document: Timeline Redesign\n\n## Overview\n\nタイムラインと本一覧をタブで切り替え可能な統合ビューとして再設計する。Figma デザイン（node-id: 14:467）に基づき、縦ライン・ドットによるビジュアルタイムラインと書影表示を実現する。\n\n**プロダクト名:** Logbook（「読書ログ」という名称は使用しない）\n\n**主な変更:**\n1. `HomePage` コンポーネントでタブナビゲーションを実装（「読書ログ」タイトル削除）\n2. `TimelineView` / `BookListView` をタブ内コンテンツとして分離\n3. 既存の Timeline コンポーネント群を Figma デザインに合わせてリファクタリング\n4. 書影（coverUrl）のタイムライン表示対応\n5. `Layout` ヘッダーのシンプル化（本アイコン追加、ナビリンク削除）\n6. タイムラインのドット・縦ラインはログエントリのみに適用（本ヘッダーには適用しない）\n7. **引用表示をFigmaデザインに準拠したグレー系スタイルに変更**\n8. **ヘッダーにユーザー情報（アイコン + ユーザー名）を表示**\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n- **React 19 + TypeScript**: 既存のコンポーネントパターンを継承\n- **Tailwind CSS**: Figma デザインの色・サイズを Tailwind クラスで実装\n- **カスタムフック**: タブ状態管理用フック `useTabNavigation` を追加\n\n### Project Structure (structure.md)\n- `src/components/` 配下に新規コンポーネントを配置\n- 既存の `Timeline/` ディレクトリを活用しつつリファクタリング\n- `src/hooks/` にタブ管理フックを追加\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n- **`Timeline.tsx`**: グループ化ロジック（`groupLogsByBook`）を再利用\n- **`TimelineGroup.tsx`**: 書影表示を追加してリファクタリング\n- **`TimelineItem.tsx`**: Figma デザインに合わせて簡素化\n- **`QuoteDisplay.tsx`**: 引用表示はスタイルを変更（amber→グレー系）\n- **`BookListPage.tsx`**: 本一覧のデータ取得・表示ロジックを抽出\n- **`QuickLogModal.tsx`**: ヘッダーの「ログを追加」ボタンから呼び出し\n\n### Integration Points\n- **`useTimeline` hook**: タイムラインデータ取得は既存を使用\n- **`getBooks` service**: 本一覧データ取得は既存を使用\n- **`useKeyboardShortcuts`**: Alt+H/Alt+B をタブ切り替えに対応\n\n## Architecture\n\n```mermaid\ngraph TD\n    subgraph HomePage\n        HP[HomePage] --> TN[TabNavigation]\n        HP --> TV[TimelineView]\n        HP --> BLV[BookListView]\n        HP --> HAB[HeaderActionButtons]\n    end\n\n    subgraph TimelineView\n        TV --> TL[Timeline]\n        TL --> TG[TimelineGroup]\n        TG --> BC[BookCover]\n        TG --> TI[TimelineItem]\n        TI --> QD[QuoteDisplay]\n    end\n\n    subgraph BookListView\n        BLV --> BG[BookGrid]\n        BG --> BCard[BookCard]\n    end\n\n    subgraph Hooks\n        TV --> UT[useTimeline]\n        BLV --> UBL[useBookList]\n        HP --> UTN[useTabNavigation]\n    end\n\n    subgraph Services\n        UT --> LS[logs service]\n        UBL --> BS[books service]\n    end\n```\n\n### Modular Design Principles\n- **Single File Responsibility**: 各コンポーネントは単一の役割\n  - `TabNavigation`: タブ UI の表示のみ\n  - `TimelineView`: タイムライン表示のコンテナ\n  - `BookListView`: 本一覧表示のコンテナ\n- **Component Isolation**: タブ内コンテンツは独立してテスト可能\n- **Service Layer Separation**: データ取得は既存 hooks/services を利用\n\n## Components and Interfaces\n\n### HomePage (新規)\n- **Purpose:** タブナビゲーションとビューの切り替えを管理するメインページ\n- **Location:** `src/pages/HomePage.tsx`\n- **Changes:**\n  - 「読書ログ」タイトル・サブタイトルを削除\n  - ヘッダーにユーザー情報を表示（Layout経由）\n- **Interfaces:**\n  ```typescript\n  // 内部状態のみ、props なし\n  export function HomePage(): JSX.Element\n  ```\n- **Dependencies:** `TabNavigation`, `TimelineView`, `BookListView`, `HeaderActionButtons`, `useTabNavigation`\n\n### Layout (リファクタリング)\n- **Purpose:** アプリケーション全体のレイアウト（ヘッダー、メインコンテンツ）\n- **Location:** `src/components/common/Layout.tsx`\n- **Changes:**\n  - ヘッダー左側に本アイコン（SVG）を追加\n  - ヘッダー右側のナビゲーションリンク（「Timeline」「Books」）を削除\n  - ヘッダー右側に `UserInfo` コンポーネントを追加\n- **Interfaces:**\n  ```typescript\n  interface LayoutProps {\n    children: React.ReactNode;\n  }\n  ```\n- **Dependencies:** React Router `Link`, `UserInfo`\n\n### UserInfo (新規)\n- **Purpose:** ヘッダーに表示するユーザー情報（アイコン + ユーザー名）\n- **Location:** `src/components/common/UserInfo.tsx`\n- **Description:** 「誰の読書記録か」を示す重要な要素。現時点では固定のダミーデータを表示し、将来的に認証機能と連携予定。\n- **Interfaces:**\n  ```typescript\n  interface UserInfoProps {\n    name?: string;      // ユーザー名（デフォルト: \"ゲスト\"）\n    avatarUrl?: string; // アバター画像URL（省略時はイニシャルアバター）\n  }\n  ```\n- **Visual Design:**\n  - アバター: 32x32px、円形、グレー背景（#ECECF0）にイニシャル表示\n  - ユーザー名: 14px、グレー（#717182）\n  - レイアウト: アバターとユーザー名を横並び、gap 8px\n- **Default Behavior:**\n  - name 未指定時: 「ゲスト」を表示\n  - avatarUrl 未指定時: ユーザー名の最初の1文字をイニシャルとして表示\n- **Implementation Example:**\n  ```tsx\n  <div className=\"flex items-center gap-2\">\n    {avatarUrl ? (\n      <img src={avatarUrl} alt={name} className=\"w-8 h-8 rounded-full\" />\n    ) : (\n      <div className=\"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-sm text-gray-500 font-medium\">\n        {name?.charAt(0) || 'ゲ'}\n      </div>\n    )}\n    <span className=\"text-sm text-gray-500\">{name || 'ゲスト'}</span>\n  </div>\n  ```\n- **Dependencies:** なし（純粋な UI コンポーネント）\n\n### TabNavigation (新規)\n- **Purpose:** タイムライン/本一覧のタブ切り替え UI\n- **Location:** `src/components/common/TabNavigation.tsx`\n- **Interfaces:**\n  ```typescript\n  interface TabNavigationProps {\n    activeTab: 'timeline' | 'books';\n    onTabChange: (tab: 'timeline' | 'books') => void;\n  }\n  ```\n- **Dependencies:** なし（純粋な UI コンポーネント）\n\n### HeaderActionButtons (新規)\n- **Purpose:** 「ログを追加」「本を追加」ボタン群\n- **Location:** `src/components/common/HeaderActionButtons.tsx`\n- **Interfaces:**\n  ```typescript\n  interface HeaderActionButtonsProps {\n    onAddLog: () => void;\n  }\n  ```\n- **Dependencies:** `Button`, React Router `Link`\n\n### TimelineView (新規)\n- **Purpose:** タイムラインタブのコンテンツコンテナ\n- **Location:** `src/components/Timeline/TimelineView.tsx`\n- **Interfaces:**\n  ```typescript\n  export function TimelineView(): JSX.Element\n  ```\n- **Dependencies:** `Timeline`, `useTimeline`\n- **Reuses:** 既存の `useTimeline` hook\n\n### BookListView (新規)\n- **Purpose:** 本一覧タブのコンテンツコンテナ\n- **Location:** `src/components/BookList/BookListView.tsx`\n- **Interfaces:**\n  ```typescript\n  export function BookListView(): JSX.Element\n  ```\n- **Dependencies:** `BookGrid`, `useBookList`\n- **Reuses:** 既存の `BookListPage` のロジックを抽出\n\n### BookGrid (新規)\n- **Purpose:** 本一覧のグリッド表示\n- **Location:** `src/components/BookList/BookGrid.tsx`\n- **Interfaces:**\n  ```typescript\n  interface BookGridProps {\n    books: BookWithLogCount[];\n    onDelete?: (bookId: string) => Promise<void>;\n  }\n  ```\n- **Dependencies:** `BookCard`\n\n### BookCover (新規)\n- **Purpose:** 書影のサムネイル表示\n- **Location:** `src/components/common/BookCover.tsx`\n- **Interfaces:**\n  ```typescript\n  interface BookCoverProps {\n    coverUrl: string | null;\n    title: string;\n    size?: 'sm' | 'md' | 'lg';\n    className?: string;\n  }\n  ```\n- **Dependencies:** なし\n\n### TimelineGroup (リファクタリング)\n- **Purpose:** 本ごとのロググループ表示（書影追加）\n- **Location:** `src/components/Timeline/TimelineGroup.tsx`\n- **Changes:**\n  - 書影サムネイル（`BookCover`）を追加\n  - 本ヘッダーからドット・縦ラインを削除（ログエントリのみに表示）\n  - 書影と本タイトルのみをヘッダーとして表示\n- **Interfaces:**\n  ```typescript\n  interface TimelineGroupProps {\n    book: Book;\n    logs: LogWithBook[];\n    isLastGroup?: boolean;\n  }\n  ```\n- **Dependencies:** `BookCover`, `TimelineItem`\n\n**注:** 本ヘッダーにはドットや縦ラインを表示せず、書影と本情報のみを表示する。これにより、本とログの視覚的な区別を明確にする。\n\n### TimelineItem (リファクタリング)\n- **Purpose:** 個別ログエントリの表示（Figma デザインに合わせて簡素化）\n- **Location:** `src/components/Timeline/TimelineItem.tsx`\n- **Changes:**\n  - カード枠を削除、シンプルな表示に変更\n  - ドットスタイルを Figma に合わせて調整\n  - 削除ボタンのみ残す（編集機能は本詳細ページで）\n- **Interfaces:**\n  ```typescript\n  interface TimelineItemProps {\n    log: Log;\n    isLast?: boolean;\n    onDelete?: (logId: string) => Promise<void>;\n    isDeleting?: boolean;\n  }\n  ```\n\n### QuoteDisplay (リファクタリング)\n- **Purpose:** 引用タイプのログ表示\n- **Location:** `src/components/Timeline/QuoteDisplay.tsx`\n- **Changes:**\n  - 背景色を削除（透明に）\n  - 左ボーダー色を amber-400 → gray-200（#ECECF0）に変更\n  - テキスト色を gray-700 → gray-500（#717182）に変更\n  - イタリック体を維持\n  - 角丸（rounded-r）を削除\n- **Interfaces:**\n  ```typescript\n  interface QuoteDisplayProps {\n    content: string;\n  }\n  ```\n- **Before (現在):**\n  ```tsx\n  <blockquote className=\"border-l-4 border-amber-400 pl-4 py-1 italic text-gray-700 bg-amber-50/50 rounded-r\">\n  ```\n- **After (Figma準拠):**\n  ```tsx\n  <blockquote className=\"border-l-4 border-gray-200 pl-5 italic text-gray-500\">\n  ```\n\n### useTabNavigation (新規フック)\n- **Purpose:** タブ状態管理とキーボードショートカット連携\n- **Location:** `src/hooks/useTabNavigation.ts`\n- **Interfaces:**\n  ```typescript\n  type TabType = 'timeline' | 'books';\n\n  interface UseTabNavigationReturn {\n    activeTab: TabType;\n    setActiveTab: (tab: TabType) => void;\n  }\n\n  export function useTabNavigation(defaultTab?: TabType): UseTabNavigationReturn\n  ```\n- **Dependencies:** React hooks\n\n### useBookList (新規フック)\n- **Purpose:** 本一覧のデータ取得・削除処理\n- **Location:** `src/hooks/useBookList.ts`\n- **Interfaces:**\n  ```typescript\n  interface UseBookListReturn {\n    books: BookWithLogCount[];\n    isLoading: boolean;\n    error: string | null;\n    deleteBook: (bookId: string) => Promise<void>;\n    refetch: () => Promise<void>;\n  }\n\n  export function useBookList(): UseBookListReturn\n  ```\n- **Dependencies:** `books` service\n- **Reuses:** `BookListPage` のロジックを抽出\n\n## Data Models\n\n既存の型を使用。新規の型定義は不要。\n\n### 使用する既存型\n```typescript\n// Book (types/index.ts)\ninterface Book {\n  id: string;\n  title: string;\n  author: string | null;\n  coverUrl: string | null;  // 書影表示に使用\n  // ...\n}\n\n// LogWithBook (types/index.ts)\ninterface LogWithBook extends Log {\n  book: Book;\n}\n\n// BookWithLogCount (types/index.ts)\ninterface BookWithLogCount extends Book {\n  logCount: number;\n}\n```\n\n### 新規型（ローカル定義）\n```typescript\n// TabType (useTabNavigation.ts 内)\ntype TabType = 'timeline' | 'books';\n```\n\n## UI Design Details\n\n### カラーパレット（Figma node-id: 14:467 より）\n| 用途 | 色 | Tailwind |\n|------|-----|----------|\n| 背景 | #FFFFFF | `bg-white` |\n| タブ背景（非選択） | #ECECF0 | `bg-gray-100` |\n| テキスト（メイン） | #0A0A0A | `text-gray-900` |\n| テキスト（サブ） | #717182 | `text-gray-500` |\n| ドット（ログ） | #717182 | `bg-gray-500` |\n| ドット（引用） | #717182 border | `border-2 border-gray-500 bg-transparent` |\n| 縦ライン | rgba(0,0,0,0.1) | `bg-black/10` |\n| 引用ボーダー | #ECECF0 | `border-gray-200` |\n| 引用テキスト | #717182 | `text-gray-500` |\n| ボタン（プライマリ） | #030213 | `bg-gray-900` |\n| 書影背景（フォールバック） | #ECECF0 | `bg-gray-100` |\n| ユーザーアバター背景 | #ECECF0 | `bg-gray-100` |\n| ユーザー名テキスト | #717182 | `text-gray-500` |\n\n### サイズ仕様（Figma node-id: 14:467 より）\n| 要素 | サイズ | Tailwind |\n|------|--------|----------|\n| タブ高さ | 36px | `h-9` |\n| タブ角丸 | 14px | `rounded-[14px]` |\n| ドット | 16px | `w-4 h-4` |\n| 縦ライン幅 | 2px | `w-0.5` |\n| 書影サムネイル | 48x64px | `w-12 h-16` |\n| 書影角丸 | 4px | `rounded` |\n| ログ本文 | 16px / line-height 26px | `text-base leading-relaxed` |\n| タイムスタンプ | 14px | `text-sm` |\n| 削除アイコン | 16px | `w-4 h-4` |\n| 本タイトル | 18px / bold | `text-lg font-bold` |\n| 著者名 | 14px | `text-sm` |\n| 引用左ボーダー | 4px | `border-l-4` |\n| 引用左パディング | 20px | `pl-5` |\n| ユーザーアバター | 32x32px | `w-8 h-8` |\n| ユーザー名 | 14px | `text-sm` |\n| アバターとユーザー名の間隔 | 8px | `gap-2` |\n\n### コンポーネント間のスペーシング\n| 要素間 | 間隔 | Tailwind |\n|--------|------|----------|\n| 本ヘッダーとログ | 24px | `mb-6` |\n| ログ間 | 24px | `pb-6` |\n| 本グループ間 | 32px | `mb-8` |\n| 書影と本情報 | 12px | `gap-3` |\n| ドットとコンテンツ | 32px | `pl-8` |\n\n**注:** 本ヘッダーにはドットを表示しないため、「ドット（本）」の定義は削除。\n\n## Visual Reference\n\n### ログエントリのレイアウト（Figmaより）\n```\n┌─────────────────────────────────────────────────────┐\n│ ●  ログ本文テキスト（16px、line-height 26px）         🗑 │\n│ │  複数行にわたる場合は折り返して表示される           │\n│ │  2025年12月16日 20:53 (14px, gray)                │\n│ │                                                    │\n│ │                                                    │\n│ ○  「これは引用です」(italic, gray, border-left)   🗑 │\n│    2025年12月16日 19:41                              │\n└─────────────────────────────────────────────────────┘\n\n凡例:\n● = 通常ログのドット（塗りつぶし）\n○ = 引用ログのドット（ボーダーのみ）\n│ = 縦ライン（rgba(0,0,0,0.1)）\n🗑 = 削除ボタン（ホバー時のみ表示）\n```\n\n### 本ヘッダーのレイアウト（Figmaより）\n```\n┌─────────────────────────────────────────────────────┐\n│ ┌────┐  本のタイトル (18px, bold)                    │\n│ │ 📖 │  著者名 (14px, gray)                          │\n│ └────┘                                               │\n└─────────────────────────────────────────────────────┘\n\n凡例:\n📖 = 書影サムネイル (48x64px) or デフォルトアイコン\n※ 本ヘッダーにはドット・縦ラインなし\n```\n\n### ヘッダーのレイアウト\n```\n┌─────────────────────────────────────────────────────┐\n│ 📖 Logbook                              (●) ゲスト │\n└─────────────────────────────────────────────────────┘\n\n凡例:\n📖 = 本アイコン（SVG）\n(●) = ユーザーアバター（32x32px、円形、イニシャル表示）\nゲスト = ユーザー名（14px、グレー）\n```\n\n## Error Handling\n\n### Error Scenarios\n1. **タイムライン読み込み失敗**\n   - **Handling:** `useTimeline` の既存エラーハンドリングを継続\n   - **User Impact:** エラーメッセージと再読み込みボタンを表示\n\n2. **本一覧読み込み失敗**\n   - **Handling:** `useBookList` でエラー状態を管理\n   - **User Impact:** エラーメッセージと再読み込みボタンを表示\n\n3. **書影画像の読み込み失敗**\n   - **Handling:** `BookCover` コンポーネントで `onError` をハンドル\n   - **User Impact:** デフォルトの本アイコンにフォールバック\n\n## Testing Strategy\n\n### Unit Testing\n- `TabNavigation`: タブクリックで正しいコールバックが呼ばれるか\n- `BookCover`: coverUrl の有無でレンダリングが切り替わるか\n- `QuoteDisplay`: 新しいスタイル（グレー系）で正しくレンダリングされるか\n- `UserInfo`: name/avatarUrl の有無で正しくレンダリングされるか\n- `useTabNavigation`: 初期値とタブ切り替えの状態管理\n- `useBookList`: データ取得・削除・エラーハンドリング\n\n### Integration Testing\n- `HomePage`: タブ切り替えで正しいビューが表示されるか\n- `TimelineView`: データフェッチからレンダリングまでの流れ\n- `BookListView`: データフェッチからレンダリングまでの流れ\n\n### End-to-End Testing\n- タイムラインタブでログが正しく表示される\n- 本一覧タブで本が正しく表示される\n- タブ切り替えがスムーズに動作する\n- 「ログを追加」ボタンでモーダルが開く\n- 「本を追加」ボタンで本登録ページに遷移する\n- キーボードショートカット（Alt+H, Alt+B）が動作する\n- 引用ログが正しいスタイル（グレー系）で表示される\n- ヘッダーにユーザー情報（アバター + ユーザー名）が表示される\n\n## Migration Notes\n\n### ルーティング変更\n- `/` → `HomePage`（タイムライン + 本一覧の統合ビュー）\n- `/books` → 削除（`HomePage` の本一覧タブに統合）\n- `/books/new`, `/books/:id` → 変更なし\n\n### 既存ページの扱い\n- `TimelinePage.tsx` → 削除または `TimelineView` に統合\n- `BookListPage.tsx` → ロジックを `useBookList` と `BookListView` に分離後、削除検討\n\n### キーボードショートカット\n- `Alt+H`: タイムラインタブをアクティブに\n- `Alt+B`: 本一覧タブをアクティブに\n- `useKeyboardShortcuts` を更新して `useTabNavigation` と連携\n\n### スタイル変更（QuoteDisplay）\n- **Before:** `border-amber-400 bg-amber-50/50 text-gray-700 rounded-r`\n- **After:** `border-gray-200 text-gray-500`（背景・角丸なし）\n",
  "fileStats": {
    "size": 19583,
    "lines": 503,
    "lastModified": "2025-12-17T15:44:29.586Z"
  },
  "comments": []
}