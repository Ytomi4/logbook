{
  "id": "snapshot_1765979589181_6redvx71s",
  "approvalId": "approval_1765979589176_2mytwgc5t",
  "approvalTitle": "Timeline Redesign - Design Document",
  "version": 1,
  "timestamp": "2025-12-17T13:53:09.181Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document: Timeline Redesign\n\n## Overview\n\nタイムラインと本一覧をタブで切り替え可能な統合ビューとして再設計する。Figma デザイン（node-id: 11:136）に基づき、縦ライン・ドットによるビジュアルタイムラインと書影表示を実現する。\n\n**主な変更:**\n1. `HomePage` コンポーネントでタブナビゲーションを実装\n2. `TimelineView` / `BookListView` をタブ内コンテンツとして分離\n3. 既存の Timeline コンポーネント群を Figma デザインに合わせてリファクタリング\n4. 書影（coverUrl）のタイムライン表示対応\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n- **React 19 + TypeScript**: 既存のコンポーネントパターンを継承\n- **Tailwind CSS**: Figma デザインの色・サイズを Tailwind クラスで実装\n- **カスタムフック**: タブ状態管理用フック `useTabNavigation` を追加\n\n### Project Structure (structure.md)\n- `src/components/` 配下に新規コンポーネントを配置\n- 既存の `Timeline/` ディレクトリを活用しつつリファクタリング\n- `src/hooks/` にタブ管理フックを追加\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n- **`Timeline.tsx`**: グループ化ロジック（`groupLogsByBook`）を再利用\n- **`TimelineGroup.tsx`**: 書影表示を追加してリファクタリング\n- **`TimelineItem.tsx`**: Figma デザインに合わせて簡素化\n- **`QuoteDisplay.tsx`**: 引用表示はそのまま活用\n- **`BookListPage.tsx`**: 本一覧のデータ取得・表示ロジックを抽出\n- **`QuickLogModal.tsx`**: ヘッダーの「ログを追加」ボタンから呼び出し\n\n### Integration Points\n- **`useTimeline` hook**: タイムラインデータ取得は既存を使用\n- **`getBooks` service**: 本一覧データ取得は既存を使用\n- **`useKeyboardShortcuts`**: Alt+H/Alt+B をタブ切り替えに対応\n\n## Architecture\n\n```mermaid\ngraph TD\n    subgraph HomePage\n        HP[HomePage] --> TN[TabNavigation]\n        HP --> TV[TimelineView]\n        HP --> BLV[BookListView]\n        HP --> HAB[HeaderActionButtons]\n    end\n\n    subgraph TimelineView\n        TV --> TL[Timeline]\n        TL --> TG[TimelineGroup]\n        TG --> BC[BookCover]\n        TG --> TI[TimelineItem]\n        TI --> QD[QuoteDisplay]\n    end\n\n    subgraph BookListView\n        BLV --> BG[BookGrid]\n        BG --> BCard[BookCard]\n    end\n\n    subgraph Hooks\n        TV --> UT[useTimeline]\n        BLV --> UBL[useBookList]\n        HP --> UTN[useTabNavigation]\n    end\n\n    subgraph Services\n        UT --> LS[logs service]\n        UBL --> BS[books service]\n    end\n```\n\n### Modular Design Principles\n- **Single File Responsibility**: 各コンポーネントは単一の役割\n  - `TabNavigation`: タブ UI の表示のみ\n  - `TimelineView`: タイムライン表示のコンテナ\n  - `BookListView`: 本一覧表示のコンテナ\n- **Component Isolation**: タブ内コンテンツは独立してテスト可能\n- **Service Layer Separation**: データ取得は既存 hooks/services を利用\n\n## Components and Interfaces\n\n### HomePage (新規)\n- **Purpose:** タブナビゲーションとビューの切り替えを管理するメインページ\n- **Location:** `src/pages/HomePage.tsx`\n- **Interfaces:**\n  ```typescript\n  // 内部状態のみ、props なし\n  export function HomePage(): JSX.Element\n  ```\n- **Dependencies:** `TabNavigation`, `TimelineView`, `BookListView`, `HeaderActionButtons`, `useTabNavigation`\n\n### TabNavigation (新規)\n- **Purpose:** タイムライン/本一覧のタブ切り替え UI\n- **Location:** `src/components/common/TabNavigation.tsx`\n- **Interfaces:**\n  ```typescript\n  interface TabNavigationProps {\n    activeTab: 'timeline' | 'books';\n    onTabChange: (tab: 'timeline' | 'books') => void;\n  }\n  ```\n- **Dependencies:** なし（純粋な UI コンポーネント）\n\n### HeaderActionButtons (新規)\n- **Purpose:** 「ログを追加」「本を追加」ボタン群\n- **Location:** `src/components/common/HeaderActionButtons.tsx`\n- **Interfaces:**\n  ```typescript\n  interface HeaderActionButtonsProps {\n    onAddLog: () => void;\n  }\n  ```\n- **Dependencies:** `Button`, React Router `Link`\n\n### TimelineView (新規)\n- **Purpose:** タイムラインタブのコンテンツコンテナ\n- **Location:** `src/components/Timeline/TimelineView.tsx`\n- **Interfaces:**\n  ```typescript\n  export function TimelineView(): JSX.Element\n  ```\n- **Dependencies:** `Timeline`, `useTimeline`\n- **Reuses:** 既存の `useTimeline` hook\n\n### BookListView (新規)\n- **Purpose:** 本一覧タブのコンテンツコンテナ\n- **Location:** `src/components/BookList/BookListView.tsx`\n- **Interfaces:**\n  ```typescript\n  export function BookListView(): JSX.Element\n  ```\n- **Dependencies:** `BookGrid`, `useBookList`\n- **Reuses:** 既存の `BookListPage` のロジックを抽出\n\n### BookGrid (新規)\n- **Purpose:** 本一覧のグリッド表示\n- **Location:** `src/components/BookList/BookGrid.tsx`\n- **Interfaces:**\n  ```typescript\n  interface BookGridProps {\n    books: BookWithLogCount[];\n    onDelete?: (bookId: string) => Promise<void>;\n  }\n  ```\n- **Dependencies:** `BookCard`\n\n### BookCover (新規)\n- **Purpose:** 書影のサムネイル表示\n- **Location:** `src/components/common/BookCover.tsx`\n- **Interfaces:**\n  ```typescript\n  interface BookCoverProps {\n    coverUrl: string | null;\n    title: string;\n    size?: 'sm' | 'md' | 'lg';\n    className?: string;\n  }\n  ```\n- **Dependencies:** なし\n\n### TimelineGroup (リファクタリング)\n- **Purpose:** 本ごとのロググループ表示（書影追加）\n- **Location:** `src/components/Timeline/TimelineGroup.tsx`\n- **Changes:**\n  - 書影サムネイル（`BookCover`）を追加\n  - 縦ライン・ドットのスタイル調整\n- **Interfaces:**\n  ```typescript\n  interface TimelineGroupProps {\n    book: Book;\n    logs: LogWithBook[];\n    isLastGroup?: boolean;\n  }\n  ```\n- **Dependencies:** `BookCover`, `TimelineItem`\n\n### TimelineItem (リファクタリング)\n- **Purpose:** 個別ログエントリの表示（Figma デザインに合わせて簡素化）\n- **Location:** `src/components/Timeline/TimelineItem.tsx`\n- **Changes:**\n  - カード枠を削除、シンプルな表示に変更\n  - ドットスタイルを Figma に合わせて調整\n  - 削除ボタンのみ残す（編集機能は本詳細ページで）\n- **Interfaces:**\n  ```typescript\n  interface TimelineItemProps {\n    log: Log;\n    isLast?: boolean;\n    onDelete?: (logId: string) => Promise<void>;\n    isDeleting?: boolean;\n  }\n  ```\n\n### useTabNavigation (新規フック)\n- **Purpose:** タブ状態管理とキーボードショートカット連携\n- **Location:** `src/hooks/useTabNavigation.ts`\n- **Interfaces:**\n  ```typescript\n  type TabType = 'timeline' | 'books';\n\n  interface UseTabNavigationReturn {\n    activeTab: TabType;\n    setActiveTab: (tab: TabType) => void;\n  }\n\n  export function useTabNavigation(defaultTab?: TabType): UseTabNavigationReturn\n  ```\n- **Dependencies:** React hooks\n\n### useBookList (新規フック)\n- **Purpose:** 本一覧のデータ取得・削除処理\n- **Location:** `src/hooks/useBookList.ts`\n- **Interfaces:**\n  ```typescript\n  interface UseBookListReturn {\n    books: BookWithLogCount[];\n    isLoading: boolean;\n    error: string | null;\n    deleteBook: (bookId: string) => Promise<void>;\n    refetch: () => Promise<void>;\n  }\n\n  export function useBookList(): UseBookListReturn\n  ```\n- **Dependencies:** `books` service\n- **Reuses:** `BookListPage` のロジックを抽出\n\n## Data Models\n\n既存の型を使用。新規の型定義は不要。\n\n### 使用する既存型\n```typescript\n// Book (types/index.ts)\ninterface Book {\n  id: string;\n  title: string;\n  author: string | null;\n  coverUrl: string | null;  // 書影表示に使用\n  // ...\n}\n\n// LogWithBook (types/index.ts)\ninterface LogWithBook extends Log {\n  book: Book;\n}\n\n// BookWithLogCount (types/index.ts)\ninterface BookWithLogCount extends Book {\n  logCount: number;\n}\n```\n\n### 新規型（ローカル定義）\n```typescript\n// TabType (useTabNavigation.ts 内)\ntype TabType = 'timeline' | 'books';\n```\n\n## UI Design Details\n\n### カラーパレット（Figma より）\n| 用途 | 色 | Tailwind |\n|------|-----|----------|\n| 背景 | #FFFFFF | `bg-white` |\n| タブ背景（非選択） | #ECECF0 | `bg-gray-100` |\n| テキスト（メイン） | #0A0A0A | `text-gray-900` |\n| テキスト（サブ） | #717182 | `text-gray-500` |\n| ドット（本） | #030213 | `bg-gray-900` |\n| ドット（ログ） | #717182 | `bg-gray-500` |\n| 縦ライン | rgba(0,0,0,0.1) | `bg-gray-200` |\n| ボタン（プライマリ） | #030213 | `bg-gray-900` |\n\n### サイズ\n| 要素 | サイズ |\n|------|--------|\n| タブ高さ | 36px |\n| タブ角丸 | 14px |\n| ドット（本） | 16px |\n| ドット（ログ） | 16px |\n| 縦ライン幅 | 2px |\n| 書影サムネイル | 48x64px |\n| 書影角丸 | 4px |\n\n## Error Handling\n\n### Error Scenarios\n1. **タイムライン読み込み失敗**\n   - **Handling:** `useTimeline` の既存エラーハンドリングを継続\n   - **User Impact:** エラーメッセージと再読み込みボタンを表示\n\n2. **本一覧読み込み失敗**\n   - **Handling:** `useBookList` でエラー状態を管理\n   - **User Impact:** エラーメッセージと再読み込みボタンを表示\n\n3. **書影画像の読み込み失敗**\n   - **Handling:** `BookCover` コンポーネントで `onError` をハンドル\n   - **User Impact:** デフォルトの本アイコンにフォールバック\n\n## Testing Strategy\n\n### Unit Testing\n- `TabNavigation`: タブクリックで正しいコールバックが呼ばれるか\n- `BookCover`: coverUrl の有無でレンダリングが切り替わるか\n- `useTabNavigation`: 初期値とタブ切り替えの状態管理\n- `useBookList`: データ取得・削除・エラーハンドリング\n\n### Integration Testing\n- `HomePage`: タブ切り替えで正しいビューが表示されるか\n- `TimelineView`: データフェッチからレンダリングまでの流れ\n- `BookListView`: データフェッチからレンダリングまでの流れ\n\n### End-to-End Testing\n- タイムラインタブでログが正しく表示される\n- 本一覧タブで本が正しく表示される\n- タブ切り替えがスムーズに動作する\n- 「ログを追加」ボタンでモーダルが開く\n- 「本を追加」ボタンで本登録ページに遷移する\n- キーボードショートカット（Alt+H, Alt+B）が動作する\n\n## Migration Notes\n\n### ルーティング変更\n- `/` → `HomePage`（タイムライン + 本一覧の統合ビュー）\n- `/books` → 削除（`HomePage` の本一覧タブに統合）\n- `/books/new`, `/books/:id` → 変更なし\n\n### 既存ページの扱い\n- `TimelinePage.tsx` → 削除または `TimelineView` に統合\n- `BookListPage.tsx` → ロジックを `useBookList` と `BookListView` に分離後、削除検討\n\n### キーボードショートカット\n- `Alt+H`: タイムラインタブをアクティブに\n- `Alt+B`: 本一覧タブをアクティブに\n- `useKeyboardShortcuts` を更新して `useTabNavigation` と連携\n",
  "fileStats": {
    "size": 11318,
    "lines": 340,
    "lastModified": "2025-12-17T13:53:02.193Z"
  },
  "comments": []
}