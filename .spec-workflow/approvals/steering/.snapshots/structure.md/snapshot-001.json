{
  "id": "snapshot_1765975410780_ciaykhl8y",
  "approvalId": "approval_1765975410776_lu2vgxu3x",
  "approvalTitle": "Project Structure - Logbookプロジェクト構造",
  "version": 1,
  "timestamp": "2025-12-17T12:43:30.780Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Project Structure\n\n## Directory Organization\n\n```\nlogbook/\n├── src/                          # フロントエンド（React）\n│   ├── components/               # UI コンポーネント\n│   │   ├── common/               # 汎用コンポーネント\n│   │   │   ├── Button.tsx\n│   │   │   ├── Card.tsx\n│   │   │   ├── ErrorBoundary.tsx\n│   │   │   ├── Input.tsx\n│   │   │   ├── Layout.tsx\n│   │   │   ├── Loading.tsx\n│   │   │   ├── Modal.tsx\n│   │   │   ├── Textarea.tsx\n│   │   │   ├── Toast.tsx\n│   │   │   └── index.ts          # バレルエクスポート\n│   │   ├── BookForm/             # 本登録フォーム\n│   │   │   ├── BookForm.tsx\n│   │   │   ├── BookSearchInput.tsx\n│   │   │   ├── NdlSearchResults.tsx\n│   │   │   └── index.ts\n│   │   ├── LogForm/              # ログ入力フォーム\n│   │   │   ├── LogForm.tsx\n│   │   │   ├── LogTypeSelector.tsx\n│   │   │   ├── QuickLogModal.tsx\n│   │   │   └── index.ts\n│   │   └── Timeline/             # タイムライン表示\n│   │       ├── Timeline.tsx\n│   │       ├── TimelineEmpty.tsx\n│   │       ├── TimelineGroup.tsx\n│   │       ├── TimelineItem.tsx\n│   │       ├── QuoteDisplay.tsx\n│   │       └── index.ts\n│   ├── pages/                    # ページコンポーネント\n│   │   ├── TimelinePage.tsx      # / - タイムライン\n│   │   ├── BookListPage.tsx      # /books - 本一覧\n│   │   ├── BookDetailPage.tsx    # /books/:id - 本詳細\n│   │   └── BookRegistrationPage.tsx  # /books/new - 本登録\n│   ├── hooks/                    # カスタムフック\n│   │   ├── useBookSearch.ts      # 本検索ロジック\n│   │   ├── useLogForm.ts         # ログフォームロジック\n│   │   ├── useTimeline.ts        # タイムラインデータ取得\n│   │   └── useKeyboardShortcuts.ts  # キーボードショートカット\n│   ├── services/                 # API クライアント\n│   │   ├── api.ts                # 共通 API 設定\n│   │   ├── books.ts              # 本 API\n│   │   ├── logs.ts               # ログ API\n│   │   └── ndl.ts                # NDL 検索 API\n│   ├── types/                    # 型定義\n│   │   └── index.ts              # 共通型定義\n│   ├── lib/                      # ユーティリティ\n│   │   └── validation.ts         # バリデーション\n│   ├── App.tsx                   # ルートコンポーネント\n│   └── main.tsx                  # エントリーポイント\n│\n├── functions/                    # バックエンド（Cloudflare Pages Functions）\n│   ├── api/                      # API エンドポイント\n│   │   ├── _middleware.ts        # 共通ミドルウェア\n│   │   ├── [[path]].ts           # キャッチオールルート（Hono）\n│   │   ├── books/                # 本 API\n│   │   │   ├── index.ts          # GET/POST /api/books\n│   │   │   └── [bookId]/\n│   │   │       ├── index.ts      # GET/PUT/DELETE /api/books/:id\n│   │   │       └── logs.ts       # GET/POST /api/books/:id/logs\n│   │   ├── logs/                 # ログ API\n│   │   │   ├── index.ts          # GET /api/logs（タイムライン）\n│   │   │   └── [logId].ts        # PUT/DELETE /api/logs/:id\n│   │   └── ndl/                  # NDL 連携\n│   │       └── search.ts         # GET /api/ndl/search\n│   └── lib/                      # バックエンド共有ライブラリ\n│       ├── db.ts                 # Drizzle DB 設定\n│       └── utils.ts              # ユーティリティ\n│\n├── drizzle/                      # データベース\n│   └── migrations/               # マイグレーションファイル\n│\n├── tests/                        # テストファイル\n│\n├── dist/                         # ビルド出力（gitignore）\n│\n├── .spec-workflow/               # Spec Workflow 設定\n│   ├── steering/                 # Steering Documents\n│   └── templates/                # テンプレート\n│\n├── package.json\n├── tsconfig.json\n├── vite.config.ts\n├── wrangler.jsonc                # Cloudflare Workers 設定\n└── drizzle.config.ts             # Drizzle 設定\n```\n\n## Naming Conventions\n\n### Files\n- **Components**: `PascalCase.tsx`（例: `BookForm.tsx`, `TimelineItem.tsx`）\n- **Hooks**: `camelCase.ts`、`use` プレフィックス（例: `useTimeline.ts`）\n- **Services**: `camelCase.ts`（例: `books.ts`, `api.ts`）\n- **Types**: `camelCase.ts`（例: `index.ts`）\n- **Tests**: `[filename].test.ts` または `[filename].test.tsx`\n- **API Routes**: `camelCase.ts`、動的ルートは `[param].ts`\n\n### Code\n- **Types/Interfaces**: `PascalCase`（例: `Book`, `LogWithBook`, `CreateBookRequest`）\n- **Functions/Methods**: `camelCase`（例: `getBooks`, `createLog`）\n- **Constants**: `UPPER_SNAKE_CASE`（例: `API_BASE_URL`）\n- **Variables**: `camelCase`（例: `bookId`, `isLoading`）\n- **React Components**: `PascalCase`（例: `TimelinePage`, `QuickLogModal`）\n\n## Import Patterns\n\n### Import Order\n1. React 関連（`react`, `react-dom`, `react-router-dom`）\n2. 外部ライブラリ（`hono`, `drizzle-orm`, `zod`）\n3. 内部モジュール（`@/components`, `@/hooks`）\n4. 相対インポート（`./`, `../`）\n5. スタイル（CSS）\n\n### Module/Package Organization\n```typescript\n// 例: コンポーネントのインポート\nimport { BrowserRouter, Routes, Route } from 'react-router-dom';\nimport { Layout, ErrorBoundary, ToastProvider } from './components/common';\nimport { TimelinePage } from './pages/TimelinePage';\nimport { useKeyboardShortcuts } from './hooks/useKeyboardShortcuts';\n```\n\n- 各 components ディレクトリには `index.ts` でバレルエクスポート\n- 型定義は `types/index.ts` に集約\n\n## Code Structure Patterns\n\n### React Component Organization\n```typescript\n// 1. インポート\nimport { useState, useEffect } from 'react';\nimport { SomeComponent } from './SomeComponent';\nimport type { SomeType } from '../types';\n\n// 2. 型定義（ローカル）\ninterface Props {\n  // ...\n}\n\n// 3. コンポーネント本体\nexport function ComponentName({ prop1, prop2 }: Props) {\n  // 3.1 State / Hooks\n  const [state, setState] = useState();\n\n  // 3.2 Effects\n  useEffect(() => { /* ... */ }, []);\n\n  // 3.3 Event Handlers\n  const handleClick = () => { /* ... */ };\n\n  // 3.4 Render\n  return (\n    <div>...</div>\n  );\n}\n```\n\n### Custom Hook Organization\n```typescript\n// 1. インポート\nimport { useState, useCallback } from 'react';\nimport { someService } from '../services/some';\n\n// 2. Hook 本体\nexport function useSomething() {\n  // State\n  const [data, setData] = useState();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Actions\n  const fetchData = useCallback(async () => {\n    // ...\n  }, []);\n\n  // Return\n  return { data, loading, error, fetchData };\n}\n```\n\n### API Service Organization\n```typescript\n// 1. 型インポート\nimport type { Book, CreateBookRequest } from '../types';\n\n// 2. API 関数\nexport async function getBooks(): Promise<Book[]> {\n  const response = await fetch('/api/books');\n  return response.json();\n}\n\nexport async function createBook(data: CreateBookRequest): Promise<Book> {\n  // ...\n}\n```\n\n## Code Organization Principles\n\n1. **Single Responsibility**: 1ファイル = 1コンポーネント/1フック/1サービス\n2. **Feature-based Grouping**: 機能ごとにコンポーネントをグループ化（BookForm, LogForm, Timeline）\n3. **Colocation**: 関連するファイルは近くに配置\n4. **Barrel Exports**: `index.ts` でディレクトリ単位のエクスポートを管理\n\n## Module Boundaries\n\n### Frontend / Backend 分離\n- `src/` - フロントエンド専用（React, ブラウザ API）\n- `functions/` - バックエンド専用（Cloudflare Workers, D1）\n- `types/` - 型定義はフロントエンドで定義、API レスポンスとして共有\n\n### コンポーネント階層\n```\npages/          → ページ単位のコンポーネント（ルーティング対応）\n  ↓ 使用\ncomponents/     → 再利用可能な UI コンポーネント\n  ↓ 使用\nhooks/          → ビジネスロジック・データ取得\n  ↓ 使用\nservices/       → API 通信\n```\n\n### 依存方向\n- `pages` → `components`, `hooks`\n- `components` → `hooks`（一部）\n- `hooks` → `services`\n- `services` → `types`\n\n## Code Size Guidelines\n\n- **File size**: 300行以下を目安\n- **Function size**: 50行以下を目安\n- **Component**: 150行以下を目安（大きくなったら分割）\n- **Nesting depth**: 最大3レベル\n\n## Documentation Standards\n\n- 複雑なロジックにはインラインコメント\n- 型定義で自己文書化（JSDoc は必須ではない）\n- README.md でプロジェクト概要とセットアップ手順を記載\n",
  "fileStats": {
    "size": 9519,
    "lines": 247,
    "lastModified": "2025-12-17T12:43:24.980Z"
  },
  "comments": []
}